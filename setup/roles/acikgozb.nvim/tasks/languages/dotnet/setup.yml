- name: Install .NET
  become_user: "{{ lookup('env', 'USER') }}"
  block:
    - name: Download dotnet-tools.
      ansible.builtin.get_url:
        url: https://dot.net/v1/dotnet-install.sh
        dest: /tmp
        mode: "0755"

    - name: Install .NET via dotnet-tools.
      ansible.builtin.shell:
        cmd: /tmp/dotnet-install.sh --channel {{ dotnet_sdk_version }} --install-dir ~/bin
        executable: /usr/bin/zsh
      register: dotnet_install_out
      changed_when: not dotnet_install_out.stderr is defined

- name: Remove the temporary files.
  ansible.builtin.file:
    path: /tmp/dotnet-install.sh
    state: absent

- name: Verify that .NET is installed.
  become_user: "{{ lookup('env', 'USER') }}"
  block:
    - name: Get info about .NET version.
      ansible.builtin.shell:
        cmd: ~/bin/dotnet --version
      register: dotnet_version_out

    - name: Ensure that the version output exists.
      ansible.builtin.debug:
        msg: .NET is installed successfully.
      when: dotnet_version_out.stdout is defined
